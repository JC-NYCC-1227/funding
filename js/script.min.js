$(document).ready(function(){function t(){var t;$("body").height()<$(window).height()?(t=$(window).height()+"px",$("body").css("overflow-y","hidden")):(t=$("body").height()+parseInt($("body").css("margin-top").slice(0,-2))+parseInt($("body").css("margin-bottom").slice(0,-2))+"px",$("body").css("overflow-y","visible")),$("#search-container").css({left:"-"+$("#search-container").width()+"px",height:t})}$("#modal").iziModal({fullscreen:!1,headerColor:"#2F56A6",onOpening:function(){$(".iziModal-content").animate({opacity:1},1e3)}}),$.ajax({type:"GET",url:"https://data.cityofnewyork.us/resource/pysf-7m9i.json",data:{$limit:1e10,$$app_token:"yTdpNEcXki56kPgsDBxj2nuYf"},success:function(a){var e,o,r,n=1,i={},s={budget_by_area:[],yearly_amount:[]},l={budget_by_area:[],yearly_amount:[]},d={budget_by_area:[],yearly_amount:[]},c={budget_by_area:[],yearly_amount:[]},u={budget_by_area:[],yearly_amount:[]},b={budget_by_area:[],yearly_amount:[]};a.forEach(function(t,e){switch(!t.hasOwnProperty("address")&&(a[e].address=""),!t.hasOwnProperty("address_2_optional")&&(a[e].address_2_optional=""),!t.hasOwnProperty("agency")&&(a[e].agency=""),!t.hasOwnProperty("amount")&&(a[e].amount=""),!t.hasOwnProperty("borough")&&(a[e].borough=""),!t.hasOwnProperty("city")&&(a[e].city=""),!t.hasOwnProperty("council_district")&&(a[e].council_district=""),!t.hasOwnProperty("council_member")&&(a[e].council_member=""),!t.hasOwnProperty("fiscal_year")&&(a[e].fiscal_year=""),!t.hasOwnProperty("legal_name_of_organization")&&(a[e].legal_name_of_organization=""),!t.hasOwnProperty("postcode")&&(a[e].postcode=""),!t.hasOwnProperty("purpose_of_funds")&&(a[e].purpose_of_funds=""),!t.hasOwnProperty("program_name")&&(a[e].program_name=""),!t.hasOwnProperty("source")&&(a[e].source=""),!t.hasOwnProperty("state")&&(a[e].state=""),!t.hasOwnProperty("status")&&(a[e].status=""),i.hasOwnProperty(t.fiscal_year)?i[t.fiscal_year].all.push(t):i[t.fiscal_year]={all:[t],agencies:{},agencies_amount:{},manhattan:0,brooklyn:0,bronx:0,"staten island":0,queens:0,citywide:0,manhattan_amount:0,brooklyn_amount:0,bronx_amount:0,staten_island_amount:0,queens_amount:0,citywide_amount:0},i[t.fiscal_year].agencies.hasOwnProperty(t.agency.toUpperCase().trim())?(i[t.fiscal_year].agencies[t.agency.toUpperCase().trim()]+=1,i[t.fiscal_year].agencies_amount[t.agency.toUpperCase().trim()]+=parseInt(t.amount)):(i[t.fiscal_year].agencies[t.agency.toUpperCase().trim()]=1,i[t.fiscal_year].agencies_amount[t.agency.toUpperCase().trim()]=parseInt(t.amount)),t.borough.toLowerCase().trim()){case"":i[t.fiscal_year].citywide_amount+=parseInt(t.amount),i[t.fiscal_year].citywide+=1;break;case"staten is":i[t.fiscal_year].staten_island_amount+=parseInt(t.amount),i[t.fiscal_year]["staten island"]+=1;break;case"bronx":i[t.fiscal_year].bronx_amount+=parseInt(t.amount),i[t.fiscal_year][t.borough.toLowerCase().trim()]+=1;break;case"brooklyn":i[t.fiscal_year].brooklyn_amount+=parseInt(t.amount),i[t.fiscal_year][t.borough.toLowerCase().trim()]+=1;break;case"manhattan":i[t.fiscal_year].manhattan_amount+=parseInt(t.amount),i[t.fiscal_year][t.borough.toLowerCase().trim()]+=1;break;case"queens":i[t.fiscal_year].queens_amount+=parseInt(t.amount),i[t.fiscal_year][t.borough.toLowerCase().trim()]+=1}});for(var y in i)s.budget_by_area.push(i[y].bronx),l.budget_by_area.push(i[y].brooklyn),d.budget_by_area.push(i[y].manhattan),c.budget_by_area.push(i[y]["staten island"]),u.budget_by_area.push(i[y].queens),b.budget_by_area.push(i[y].citywide),s.yearly_amount.push(i[y].bronx_amount),l.yearly_amount.push(i[y].brooklyn_amount),d.yearly_amount.push(i[y].manhattan_amount),c.yearly_amount.push(i[y].staten_island_amount),u.yearly_amount.push(i[y].queens_amount),b.yearly_amount.push(i[y].citywide_amount);var p,m={valueNames:["amount","council_member","legal_name_of_organization","source",{attr:"data-address",name:"address"},{atrt:"data-address_2_optional",name:"address_2_optional"},{attr:"data-agency",name:"agency"},{attr:"data-borough",name:"borough"},{attr:"data-city",name:"city"},{attr:"data-council_district",name:"council_district"},{attr:"data-fiscal_year",name:"fiscal_year"},{attr:"data-postcode",name:"postcode"},{attr:"data-purpose_of_funds",name:"purpose_of_funds"},{attr:"data-program_name",name:"program_name"},{attr:"data-state",name:"state"},{attr:"data-status",name:"status"}],item:"<tr onClick='fillData($(this))'><td class='trigger address address_2_optional agency bbl bin borough census_tract city community_board council_district ein fiscal_year latitude longitude mocs_id nta postcode purpose_of_funds program_name state status legal_name_of_organization'></td><td class='amount'></td><td class='council_member'></td><td class='source'></td></tr>",page:25,pagination:[{name:"paginationTop",paginationClass:"paginationTop",innerWindow:1,left:2,right:2},{paginationClass:"paginationBottom",innerWindow:1,left:2,right:2}]},g=$("#funding-chart"),h=Object.keys(i);h.pop(),h.push("Unknown");var _=function(t){var a={type:"line",data:{labels:h,datasets:[{label:"Bronx",borderColor:"rgba(47,86,166,0.5)",backgroundColor:"rgba(47,86,166,0.1)",data:s.budget_by_area},{label:"Brooklyn",borderColor:"rgba(208,93,78,0.5)",backgroundColor:"rgba(208,93,78,0.1)",data:l.budget_by_area},{label:"Manhattan",borderColor:"rgba(34,138,230,0.5)",backgroundColor:"rgba(34,138,230,0.1)",data:d.budget_by_area},{label:"Staten Island",borderColor:"rgba(18,184,134,0.5)",backgroundColor:"rgba(18,184,134,0.1)",data:c.budget_by_area},{label:"Queens",borderColor:"rgba(245,159,0,0.5)",backgroundColor:"rgba(245,159,0,0.1)",data:u.budget_by_area},{label:"Citywide",borderColor:"rgba(190,75,219,0.5)",backgroundColor:"rgba(190,75,219,0.1)",data:b.budget_by_area}]},options:{scales:{xAxes:[{ticks:{autoSkip:!1,fontSize:$(window).width()<=700?8:12}}],yAxes:[{ticks:{fontSize:$(window).width()<=700?8:12}}]},tooltips:{titleFontSize:$(window).width()<=700?8:12,bodyFontSize:$(window).width()<=700?8:12,footerFontSize:$(window).width()<=700?8:12,mode:"index",intersect:!1}}},e={type:"line",data:{labels:h,datasets:[{label:"Bronx",borderColor:"rgba(47,86,166,0.5)",backgroundColor:"rgba(47,86,166,0.1)",data:s.yearly_amount},{label:"Brooklyn",borderColor:"rgba(208,93,78,0.5)",backgroundColor:"rgba(208,93,78,0.1)",data:l.yearly_amount},{label:"Manhattan",borderColor:"rgba(34,138,230,0.5)",backgroundColor:"rgba(34,138,230,0.1)",data:d.yearly_amount},{label:"Staten Island",borderColor:"rgba(18,184,134,0.5)",backgroundColor:"rgba(18,184,134,0.1)",data:c.yearly_amount},{label:"Queens",borderColor:"rgba(245,159,0,0.5)",backgroundColor:"rgba(245,159,0,0.1)",data:u.yearly_amount},{label:"Citywide",borderColor:"rgba(190,75,219,0.5)",backgroundColor:"rgba(190,75,219,0.1)",data:b.yearly_amount}]},options:{tooltips:{titleFontSize:$(window).width()<=700?8:12,bodyFontSize:$(window).width()<=700?8:12,footerFontSize:$(window).width()<=700?8:12,mode:"index",intersect:!1,callbacks:{label:function(t,a,e){return parseInt(t.yLabel)>=1e3?a.datasets[t.datasetIndex].label+": $"+t.yLabel.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):a.datasets[t.datasetIndex].label+": $"+t.yLabel}}},scales:{xAxes:[{ticks:{autoSkip:!1,fontSize:$(window).width()<=700?8:12}}],yAxes:[{ticks:{beginAtZero:!0,callback:function(t,a,e){return parseInt(t)>=1e3?"$"+t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"$"+t},fontSize:$(window).width()<=700?8:12}}]}}};"data1"===t?p=new Chart(g,a):"data2"===t&&(p=new Chart(g,e))},f=function(t,a,e){var o,r,n=[];switch(parseInt(t)%5){case 0:borderColor="rgba(47,86,166,0.9)",o="rgba(47,86,166,0.5)";break;case 1:borderColor="rgba(208,93,78,0.9)",o="rgba(208,93,78,0.5)";break;case 2:borderColor="rgba(190,75,219,0.9)",o="rgba(190,75,219,0.5)";break;case 3:borderColor="rgba(34,138,230,0.9)",o="rgba(34,138,230,0.5)";break;case 4:borderColor="rgba(18,184,134,0.9)",o="rgba(18,184,134,0.5)";break;default:borderColor="rgba(190,75,219,0.9)",o="rgba(190,75,219,0.5)"}if("number of funds"===e){for(var i in a[t].agencies)n.push(a[t].agencies[i]);r={type:"bar",data:{labels:Object.keys(a[t].agencies),datasets:[{label:"Funds given in "+t,borderColor:borderColor,backgroundColor:o,data:n}]},options:{legend:{display:!1},scales:{xAxes:[{ticks:{autoSkip:!1,fontSize:$(window).width()<=700?8:12}}],yAxes:[{ticks:{fontSize:$(window).width()<=700?8:12}}]},tooltips:{titleFontSize:$(window).width()<=700?8:12,bodyFontSize:$(window).width()<=700?8:12,footerFontSize:$(window).width()<=700?8:12,mode:"index",intersect:!1}}}}else if("amount funded"===e){for(var i in a[t].agencies_amount)n.push(a[t].agencies_amount[i]);r={type:"bar",data:{labels:Object.keys(a[t].agencies),datasets:[{label:"Funds given in "+t,borderColor:borderColor,backgroundColor:o,data:n}]},options:{legend:{display:!1},tooltips:{titleFontSize:$(window).width()<=700?8:12,bodyFontSize:$(window).width()<=700?8:12,footerFontSize:$(window).width()<=700?8:12,mode:"index",intersect:!1,callbacks:{label:function(t,a,e){return parseInt(t.yLabel)>=1e3?"$"+t.yLabel.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"$"+t.yLabel}}},scales:{xAxes:[{ticks:{autoSkip:!1,fontSize:$(window).width()<=700?8:12}}],yAxes:[{ticks:{beginAtZero:!0,callback:function(t,a,e){return parseInt(t)>=1e3?"$"+t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"$"+t},fontSize:$(window).width()<=700?8:12}}]}}}}p.destroy(),p=new Chart(g,r)};fillData=function(t){var a,e,o,r,n,i,s=$(t).children().first(),l=$(t).children(".legal_name_of_organization").html().trim(),d=$(t).children(".council_member").html().trim(),c=$(t).children(".amount").html().trim();a=(e=null==s.attr("data-address")||""==s.attr("data-address")?"":s.attr("data-address").trim()+", ")+(o=null==s.attr("data-address_2_optional")||""==s.attr("data-address_2_optional")?"":s.attr("data-address_2_optional").trim()+", ")+(r=null==s.attr("data-city")||""==s.attr("data-city")?"":s.attr("data-city").trim()+", ")+(n=null==s.attr("data-state")||""==s.attr("data-state")?"":s.attr("data-state").trim()+" ")+(i=null==s.attr("data-postcode")||""==s.attr("data-postcode")?"":s.attr("data-postcode").trim())===""?"<strong>Address:</strong> N/A":"<strong>Address:</strong> "+e+o+r+n+i;var u="<ul><li><strong>Agency:</strong> "+s.attr("data-agency")+"</li><li><strong>Amount:</strong> $"+c+"</li><li><strong>Borough:</strong> "+s.attr("data-borough")+"</li><li><strong>Council District:</strong> "+s.attr("data-council_district")+"</li><li><strong>Council Member:</strong> "+d+"</li><li><strong>Fiscal Year:</strong> "+s.attr("data-fiscal_year")+"</li><li><strong>Status:</strong> "+s.attr("data-status")+"</li>";$(".iziModal-header-title").html(l),$(".iziModal-header-subtitle").html(s.attr("data-program_name")),$("#modal .iziModal-content .purpose").html(s.attr("data-purpose_of_funds")),$("#modal .iziModal-content .full-address").html(a),$("#modal .iziModal-content .additional-details").html(u),$("#modal").iziModal("open")},$("#search-bar #search-form").submit(function(t){t.preventDefault(),userList.clear();var n=[];$(".search-fields").each(function(){n.push($(this).attr("id"))}),function(t,a){for(var o,r=[],n=0;n<t.length;n++)r[n]=$("#"+t[n]).val().toLowerCase();(o=r.join(" ").trim().toUpperCase().split(" ")).length>1&&(o[o.length]=o[o.length-1],o[o.length-2]="and",o=o.join(" ")),e=a.filter(function(a){for(var e=0,o=0;o<t.length;o++)a[t[o]].toLowerCase().includes(r[o])&&(e+=1);if(e===t.length)return!0}),userList=new List("budgets",m,e),$("#search-results").html("<h3>"+userList.size()+" Results for: "+o+"</h3>")}(n,a),$(".sorting").click(function(t){o=$(this).attr("class").split(" ")[1].split("-")[1];var a=$(this).children().last();(r=JSON.parse($(this).attr("data-sort-asc")))?userList.sort(o,{order:"desc"}):userList.sort(o,{order:"asc"}),$(".fa-sort-desc").removeClass("fa-sort-desc"),$(".fa-sort-asc").removeClass("fa-sort-asc"),r?a.addClass("fa-sort-desc").removeClass("fa-sort-asc"):a.addClass("fa-sort-asc").removeClass("fa-sort-desc"),$(this).attr("data-sort-asc",!r)})}),$("#advanced-options input").on("change",function(){0!==$("#advanced-options input:checked").length?$(this).prop("checked")?$("div#search-field-container").prepend('<input class="search-fields" id="'+$(this).val()+'" type="text" placeholder="'+$(this).val().split("_").join(" ").titleize()+'">'):$("#"+$(this).val()).remove():(alert("You need at least one search term."),$(this).prop("checked",!0))}),$("#search-menu-button").click(function(){$("#search-container").show().animate({left:"0px"},500),t()}),$("#close-menu span").click(function(){$("#search-container").animate({left:"-"+$("#search-container").width()+"px"},500),setTimeout(function(){$("#search-container").hide()},500)}),$("#change").click(function(t){t.preventDefault(),p.destroy(),1===n?($(this).html("View Funds to Agencies"),_("data2"),n=2,$("#custom-chart-title").html("Amount Received by Organization's Borough(s)")):2===n?($(this).html("View Amount Per Agency"),$("#agency-year-slider").off().val("2009"),$("#chart-container").prepend('<div class="slide-container"><input type="range" min="2009" max="'+p.data.labels.slice(-2,-1)+'" value="2009" step="1" id="agency-year-slider" title="Move the slider to view data from other years"></div>'),f("2009",i,"number of funds"),$(".yearNumber").stop(!0,!0).html("2009").animate({opacity:1},325).animate({opacity:0},325),$("#agency-year-slider").on("input",function(t){f($(this).val(),i,"number of funds"),$(".yearNumber").stop(!0,!0).html($(this).val()).animate({opacity:1},325).animate({opacity:0},325)}),n=3,$("#custom-chart-title").html("Funds Received by Organization's Agency"),$("#agency-year-slider").show()):3===n?($(this).html("View Funds to Boroughs"),$("#agency-year-slider").off().val("2009"),f("2009",i,"amount funded"),$(".yearNumber").stop(!0,!0).html("2009").animate({opacity:1},325).animate({opacity:0},325),$("#agency-year-slider").on("input",function(t){f($(this).val(),i,"amount funded"),$(".yearNumber").stop(!0,!0).html($(this).val()).animate({opacity:1},325).animate({opacity:0},325)}),n=4,$("#custom-chart-title").html("Amount Received by Organization's Agency")):4===n&&($(this).html("View Amount Per Borough"),$(".slide-container").remove(),_("data1"),n=1,$("#custom-chart-title").html("Funds Received by Organization's Borough(s)"))}),userList=new List("budgets",m,[]),_("data1"),$("body").css({position:"static","overflow-y":"visible"}),$("#loader").hide(),$("#not-loader").css({visibility:"visible"}),t(),$(window).resize(function(){$(window).width()<=700?(p.options.tooltips.titleFontSize=8,p.options.tooltips.bodyFontSize=8,p.options.tooltips.footerFontSize=8,p.options.scales.xAxes[0].ticks.minor.fontSize=8,p.options.scales.xAxes[0].ticks.fontSize=8,p.options.scales.yAxes[0].ticks.minor.fontSize=8,p.options.scales.yAxes[0].ticks.fontSize=8):(p.options.tooltips.titleFontSize=12,p.options.tooltips.bodyFontSize=12,p.options.tooltips.footerFontSize=12,p.options.scales.xAxes[0].ticks.minor.fontSize=12,p.options.scales.xAxes[0].ticks.fontSize=12,p.options.scales.yAxes[0].ticks.minor.fontSize=12,p.options.scales.yAxes[0].ticks.fontSize=12),p.update(),t()})}}),Array.prototype.extractSubSet=function(t,a){return t&&a?this.filter(function(e){return e[t].trim()===a}):this.filter(function(a){return""===a[t].trim()||null==a[t]})},String.prototype.titleize=function(){for(var t=this.split(" "),a=t.length,e=0;e<a;e++)0===e&&(t[e]=t[e].capitalize());return t.join(" ")},String.prototype.capitalize=function(){if(this[0]&&this.toUpperCase)return this[0].toUpperCase()+this.slice(1)},/Mobi/.test(navigator.userAgent)});